良性循环 -- 软件开发中的一些小故事


1. 重构 lexer 的小故事



2. 数据分析平台的故事

这是来自于我一个朋友的故事。在他们公司里面有一个做数据分析的组，他的职责就包括数据的入库和清洗这块的事情。数据来源自公司和其它各个部门。

他所遇到的问题是，各个部门吐出来的数据格式不统一，不便于入库分析，他处理起来特别蛋疼。开始尝试一个部门一个部门地接入，但是这样做很快他就崩溃了，工作量很大，就他自己一个人要负责所有的对接，很不靠谱。

然后他换了一个方式，把大家拉到一起来开会，定制标准，约定好数据的协议格式，形成内部规范。然而，这一套也没能玩下去，其它部门的同事不太愿意配合他。本来用得好好的，现在多了所谓标准限制，要改东西，任谁都不喜欢。
还有一个让他崩溃的地方，即使公司内已经开会对数据格式达成了一致，他看到入库过来的数据还是经常有不合规范的。这群王八蛋哪天又改了东西，然后他这一块就又坏掉了，又得跨部门去沟通。

其实换位思考一下，会这样子很正常。假设另一个部门的人，凭空给你制造一些输入日志统一规范的需求，多了一堆的格式规范，并且你又看懂这么干有什么直观的好处，从这些数据分析出什么有用的价值，自然是不愿意去改改改的，也不会愿意去遵守这些格式规范。更不谈说做好完善的测试，覆盖输出日志，确认它是符合规范并阻止后续有改动破坏...那这个事情必然难以推动和落地呀！

最后，这个朋友的终极解决方案，是由他自己实现日志库，把公司层面的日志的库给统一，然后替换掉了。这样他就可以很方便控制入库的数据格式，其它部分没有什么额外工作量，也就愿意配合了。

3. CI 稳定性的故事

在我们公司，研发负责写单元测试和集成测试，有另外一个部门会负责所有的从编译，测试，打包这一系列的持续集成(CI)相关的任务。测试环境是由他们来维护的。因为有很分支，也有很多个版本，又有很多套测试要跑，所以这个组合下来，让 CI 每天自动化跑着不出问题，也是一个挺辛苦的活儿。

问题出在哪儿呢？写测试的人和具体负责让测试跑起来的人跨部门了。研发天天抱怨测试不稳定，影响合 PR，体验非常不友好。于是让 CI 稳定便成了一个 KPI 指标了。这个事情其实并不太好做，体验过了才知道。


让 CI 不稳定的原因其实是两块的，一块是测试环境的锅，测试集成的资源不够了，磁盘满了，网络挂了，机器断电了各种都有可能发生。另一块是测试本身的不稳定，

4. 构建性能测试体系

5. 良性循环

最后是一则虚拟的故事，故事可能发生在每一家公司。我把这一则故事叫，良性循环。



哦，对了，我想到一个良性循环的反义词，叫“破窗效应”...